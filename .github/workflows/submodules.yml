# Código gerado/assistido por IA
name: Submodules Dispatch
description: 
  Workflow para atualizar arquivos dos submódulos com o repositório Estatística.

on:
  workflow_dispatch:
  repository_dispatch:
    types: [atualizar-books, atualizar-newshub, atualizar-backend, atualizar-wss]

env:
  url: ${{ vars.URL }}
  TOKEN: ${{ secrets.TOKEN_REPO_SYNC }}
  USERNAME: ${{ github.repository_owner }}
  USEREMAIL: ${{ secrets.USEREMAIL }}

jobs:
  books:
    runs-on: ubuntu-latest
    environment:
      name: ENVIRONMENT
    steps:
      - name: Checkout
        uses: actions/checkout@v4
        with:
          repository: ${{ env.USERNAME }}/estatistica
          token: ${{ env.TOKEN }}
          path: "estatistica"
          ref: "main"

      - name: Atualizar submodule 'books'
        working-directory: estatistica
        run: |
          git submodule init books
          git submodule update books
      
      - name: Sincronizar pastas entre os repositórios
        run: |
          ORIGIN="books/book"
          DESTINO="estatistica/books"
          rsync -av --delete estatistica/books/ books/ --exclude=".git" --exclude=".github" --exclude=".vscode" --exclude="README.md"